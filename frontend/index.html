<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>API Fotos de Chapas</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 2rem;
        background-color: #f9f9f9;
      }
      h1 {
        color: #333;
      }
      form {
        margin-top: 1rem;
      }
      input,
      button {
        padding: 0.6rem;
        margin: 0.5rem 0;
        font-size: 1rem;
      }
      .chapa-list {
        margin-top: 2rem;
      }
      .chapa-item {
        background: #fff;
        border: 1px solid #ddd;
        padding: 1rem;
        margin-bottom: 1rem;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <h1>üì∏ API de Fotos de Chapas</h1>

    <form id="uploadForm" enctype="multipart/form-data">
      <label for="foto">Escolher imagem:</label><br />
      <input
        type="file"
        name="foto"
        id="foto"
        accept="image/*"
        required
      /><br />
      <button type="submit">Enviar Foto</button>
    </form>

    <p id="resposta"></p>

    <div class="chapa-list" id="chapaList">
      <h2>üîç Lista de Chapas</h2>
      <div id="chapasContainer">Carregando...</div>
    </div>

    <script>
      const API_URL = "https://api-fotos-chapas-production.up.railway.app";

      // Fetch lista de chapas
      async function carregarChapas() {
        try {
          const res = await fetch(`${API_URL}/db`);
          const data = await res.json();

          const container = document.getElementById("chapasContainer");
          container.innerHTML = "";

          if (!data.chapas || data.chapas.length === 0) {
            container.innerHTML = "<p>Nenhuma chapa cadastrada.</p>";
            return;
          }

          data.chapas.forEach((chapa, i) => {
            const el = document.createElement("div");
            el.className = "chapa-item";
            el.innerHTML = `
            <strong>Chapa #${i + 1}</strong><br />
            Nome: ${chapa.nome || "---"}<br />
            Medidas: ${chapa.comprimento || "-"} x ${chapa.largura || "-"}<br />
            C√≥digo Interno: ${chapa.codigo || "---"}<br />
            ID: ${chapa.id || "---"}
          `;
            container.appendChild(el);
          });
        } catch (err) {
          document.getElementById("chapasContainer").innerHTML =
            "<p>Erro ao carregar chapas.</p>";
          console.error("‚ùå Erro ao buscar /db:", err);
        }
      }

      // Envio de imagem
      document.getElementById("uploadForm").onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const respostaEl = document.getElementById("resposta");
        respostaEl.textContent = "Enviando...";

        try {
          const res = await fetch(`${API_URL}/upload`, {
            method: "POST",
            body: formData,
          });

          const text = await res.text();
          const json = JSON.parse(text);

          if (json.success) {
            respostaEl.textContent = `‚úÖ Upload feito! Nome do arquivo: ${json.fileName}`;
            carregarChapas(); // Atualiza lista ap√≥s upload
          } else {
            respostaEl.textContent = "‚ùå Erro no upload: " + json.message;
          }
        } catch (err) {
          console.error("‚ùå Erro:", err);
          respostaEl.textContent = "‚ùå Erro ao comunicar com o servidor.";
        }
      };

      // Carrega lista ao abrir a p√°gina
      carregarChapas();
    </script>
  </body>
</html>
